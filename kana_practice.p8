pico-8 cartridge // http://www.pico-8.com
version 18
__lua__
-- kana practice
-- by sestren
-- github.com/sestrenexsis/kanapractice

-- code based on shodo
-- by ryosuke mihara
-- github.com/oinariman/shodo
-- pixel art based on art by hiro (hamstone)
-- assetstore.unity.com/packages/2d/fonts/sprite-font-japanese-kana-43862

-- description:
-- * ink drying

-- modes:
-- * guided learning
-- * quiz

-- quiz mode:
-- * choose a random kana
-- * ask the player to draw it
-- * stroke order matters
-->8
-- px   : x position
-- py   : y position
-- vx   : x velocity
-- vy   : y velocity
-- lx   : last x pos
-- ly   : last y pos
-- sz   : brush radius
-- on   : using brush

-- accl : speedup when moving
-- drag : slowdown over time
-- pull : slowdown on paper
-- pool : ink spread over time
-- maxr : ink max spread

_accl=0.175
_drag=0.100
_pull=0.650
_pool=0.200
_maxr=3.000

function _init()
	cls()
	list={"a","i","u","e","o",
	"ka","ki","ku","ke","ko",
	"sa","shi","su","se","so",
	"ta","chi","tsu","te","to",
	"na","ni","nu","ne","no",
	"ha","hi","fu","he","ho",
	"ma","mi","mu","me","mo"}
	for k,v in pairs(list) do
		x=16*((k-1)%5)
		y=16*(flr((k-1)/5))
		drawkana(v,x,y)
	end
	cls()
	--sspr(0,0,128,128,0,0)
	_nib_px=64
	_nib_py=64
	_nib_vx=0
	_nib_vy=0
	_nib_lx=64
	_nib_ly=64
	_nib_sz=0
	_nib_on=false
	_ink={}
end

function _update()
 -- get input
	_nib_on=btn(❎)
	if (btn(⬆️)) _nib_vy-=_accl
	if (btn(⬇️)) _nib_vy+=_accl
	if (btn(⬅️)) _nib_vx-=_accl
	if (btn(➡️)) _nib_vx+=_accl
	-- update pen physics
	if _nib_vx>0 then
		_nib_vx-=_drag
		_nib_vx=max(0,_nib_vx)
	else
		_nib_vx+=_drag
		_nib_vx=min(0,_nib_vx)
	end
	if _nib_vy>0 then
		_nib_vy-=_drag
		_nib_vy=max(0,_nib_vy)
	else
		_nib_vy+=_drag
		_nib_vy=min(0,_nib_vy)
	end
	if (_nib_vx~=0) then
		_nib_px+=_nib_vx
	end
	if (_nib_vy~=0) then
		_nib_py+=_nib_vy
	end
	local multi=1.000
	if (_nib_on) multi=_pull
	if (_nib_vx~=0) then
		_nib_px+=multi*_nib_vx
	end
	if (_nib_vy~=0) then
		_nib_py+=multi*_nib_vy
	end
	-- update ink effects
	if _nib_on then
		_nib_sz+=_pool
	else
		_nib_sz-=_pool
	end
	_nib_sz=mid(0,_nib_sz,_maxr)
	if _nib_sz>0 then
		id=128*flr(_nib_py)
		id+=flr(_nib_px)
		if _ink[id]==nil then
			_ink[id]=_nib_sz
		elseif _ink[id]<_nib_sz then
			_ink[id]=_nib_sz
		end
	end
end

function _draw()
	cls()
	--sspr(0,0,128,128,0,0)
	for id,r in pairs(_ink) do
		px=id%128
		py=flr(id/128)%128
		circfill(px,py,r,1)
	end
	circfill(_nib_px,_nib_py,1,7)
end
-->8
-- draw kana
_kana={}
_kana["a"]={0,1,2,3}
_kana["i"]={4,5}
_kana["u"]={6,7}
_kana["e"]={8,9,10,11}
_kana["o"]={12,13,14,15}
_kana["ka"]={16,17,18}
_kana["ki"]={19,20,21,22}
_kana["ku"]={23}
_kana["ke"]={24,25,26}
_kana["ko"]={27,28}
_kana["sa"]={29,30,31}
_kana["shi"]={32}
_kana["su"]={33,34,35}
_kana["se"]={36,37,38}
_kana["so"]={39,40,41,42}
_kana["ta"]={43,44,45,46}
_kana["chi"]={47,48,49}
_kana["tsu"]={50}
_kana["te"]={51,52}
_kana["to"]={53,54}
_kana["na"]={55,56,57,58,59}
_kana["ni"]={60,61,62}
_kana["nu"]={63,64,65,66}
_kana["ne"]={67,68,69,70,71}
_kana["no"]={72,73}
_kana["ha"]={74,75,76,77}
_kana["hi"]={78,79,80}
_kana["fu"]={81,82,83,84}
_kana["he"]={85}
_kana["ho"]={86,87,88,89,90}
_kana["ma"]={91,92,93,94}
_kana["mi"]={95,96,97,98}
_kana["mu"]={99,100,101,102}
_kana["me"]={103,104,105}
_kana["mo"]={106,107,108}

function drawkana(name,x,y)
	for id in all(_kana[name]) do
		local sx=(id*8)%128
		local sy=(flr(id/16))*8
		for c in all({7,14,8,2}) do
			for xx=sx,sx+7 do
				for yy=sy,sy+7 do
					if sget(xx,yy)==c then
						pset(x+xx-sx,y+yy-sy,7)
					end
				end
			end
			flip()
		end
	end
end
__gfx__
000100000007000000010000000100000000000000000000007ee80000111100007e000000110000001100000011000000010010000700100001001000010070
0001e880000e11100001111000011110070000100100007000000000000000000000000000000000000000000000000007eee801011e1101011111010111110e
07ee0100011e010001110700011101000e0000010100000e0011110000eeee000111110007eee200011117000111110000010000000e00000001000000010000
00011110000e111000011e100001eee00e0000010100000e01000010070000e000001000000010000000e0000000100000011110000e1110000eeee000011110
00110101001e010100110e0100ee01080e0000010100000800000010000000e00001110000011100000e11000001ee0000110001001e000100e1000800110001
01011001010810010101e0010e01100808000000010000000000001000000080001101000011010000e10100001e0e0001010001010200010e01000801010001
010100010108000101020001070100080080000000100000000001000000080001100100011001000210010001e0080001010001010200010e01000801010001
00110010001800100021001000110080000000000000000000011000000880000100001101000011020000110200008800100110002001100020088000100110
000101000007010000010700000010000000100000007000000010000000070000000010000000100000007007eee80001111100000100000007000000010000
00010010000e0010000100e0007eee80001111100011e110001111100000e0000700001001000010010000e0000000800000001007eee880011e111001111110
07eee00001e110000111100000001000000010000000e00000001000000e00000e0111110107eee8010111e10000000000000000000010000000e00000001000
00100e0000e001000010010000111110007eee800011e1100011111000e000000e00001001000010010000e000000000000000000000010000000e0000000100
00100e0000e00100001001000000010000000100000008000000010000e000000e00001001000010010000e00000000000000000000011000000880000001100
01000800080001000100010000100000001000000010000000700000000800000e00001001000010010000800000000000000000010000000100000007000000
010008000800010001000100000100000001000000010000000e0000000080000080001000100010001000800100000007000000001000000010000000e00000
0000800000001000000010000000110000001100000011000000e800000008000080010000100100001008000011111000eee8800001110000011100000ee800
07000000000010000000700000001000001000100010007000700010007ee2000011170000111100001111000001000000070000000100000001000000010000
0e00000007eee8800111e1100111111000100010001000e000e0001000001000000ee000000110000001100007eee800011e1100011111000111110007eee800
0e000000000010000000e0000000100007eeee88011111e101e111110111111002e1111007eee2200111117000010000000e0000000100000001000000010000
0e000000001110000021e000002e100000100010001000e000e000100000110000001100000011000000ee000010111000e0111000107e800010111000011110
0e0000000010100000e0e0000010e000001001000010080000e00100000100000001000000010000000e00000010000000e00000001000000010000000100001
0e00008000011000000e10000001e000001000000010000000e0000000100000001000000010000000e000000100000008000000010000000100000000000001
00e0080000001000000010000000e000001000000010000000e0000000100000001000000010000000e000000101000008010000010100000107000000000001
000e8000000100000001000000080000000111100001111000088880000111000001110000011100000888000100111008001110010011100100ee8000011110
00070000000100000000000007eeee22011111170700001001000070000100000007000000010000000100000001000000000000000000000000000007000100
011e11000111110000eeee000000011000000ee000e0010000100e0007ee8010011e1010011110700111101001111010070011100100ee80010011100e000100
000e0000000100007e0000e0000010000000e000000810000001e0000010000100e000010010000e00100001001000010e01000001070000010100000e111110
000e1110000eeee00000000e00010000000e000000010000000e00000010010000e001000010010000100700001001000e00000001000000010000000e101001
002000010070000e0000000e00010000000e00000010000000e0000001000100080001000100010001000e00010001000e000000010000000100000010e01001
000000010000000e0000008000010000000e00000010000000e0000000011110000111100001111000011e10000eee800e000000010000000100000010811011
000000010000000e0000080000001000000080000010000000e0000000100100001001000010010000200e000070010008010000010100000107000001080101
000111100008888000888000000001100000088000011111000e8888000111000001110000011100000ee1000001110000801111001011110010eee800100011
01000700010001000100010007000000010000000100000001000000010000000000000000000000000001000000010000000700000001000020000000700000
01000e0001000100010001001e1100007ee200001117000011110000111100000011110000eeee00070111110107eee801011e11010111117e10010011e00200
01111e1001eeeee0011111100e1111000111110001e11100011eee000111110002070010070100e00e0001000100010001000e00010001000010011000e00210
0110e0010e101002011010010e100010011000100e1000100ee000e001100010200e00011001000e0e0001000100010001000e0001000100010001010e000201
1010e001e0101002101010011e0000101100001021000010710000e011000010200e0001100100080e0001000100010001000e0001000100010001000e000200
1011e011e0111012101110e10800011001000110010001100100012001000ee020e00001101000080e0011100100111001001e100100eee0010001000e000200
010201010e0102020101070e0800101101001011010010110100202101007018e0e000101010008008010101010101010102020101070108010001000e000200
00200011007000210010001808000100010001000100010001000200010001000e00010001000800008011000010110000102100001011000011100000eee000
00100000007e000000110000001100000011000000000000000111110007eee80001111100011711000111110000100000001000000070000000100000200000
11100700000080000000100000001000000010000000000007000100010001000100010001000e000100010007eeee80011111100111e110011111100e100000
001001e00000000000000000000000000000000000ee00000e011111010111110107eee801011e110101111100001000000010000000e0000000100070100100
01000108000100000007000000010000000100000e00e0000e000100010001000100010001000e00010001000111111007eeee800111e1100111111000100100
01000100010010100100e0100700101001001070700008000e000100010001000100010001000e000100010000001000000010000000e0000000100001111110
01000100100010011000e001e00010011000100e000000800e001110010111100100111001001e100100eee000111100001111000011e10000eee80010100101
01000100100010011000e001800010011000100800000008080101010101010101010101010202010107010801001010010010100200e0100700108010100100
00111000001100000088000000110000001100000000000000801000001010000010100000102000001010000011000000110000002200000011000001001000
00700000001000000010000000100000007000000010000000100000070001000100070001000100000700000001000000010000000000000000000000000000
01e00000011000000110000000e8010000e1010000110100001107000e00010001000e0001000100011e110007eee80001111100000000000000000000000000
10e0010010100100101007007e10001011e0001011100010111000e00e11110001211e00017eee00000e00000001000000010000000000000000000000000000
00e001000010010000100e000010000000e0000000100000001000000e0010100200e010010010e0011e11000111110007eee800000000000000000000000000
01e111100eeee88001111e100110000001e000000e1000000110000010e010012010e0011010100e000e00000001000000010000000000000000000000000000
20e001017010010810100e011010001020e0001070e000801010001010e10001201e000110110008000e00080001000100010001000000000000000000000000
202001001010010010100800011000100210001001e00080011000101080001020e0001010100080000e00080001000100010001000000000000000000000000
0200100001001000010080000001110000011100000eee0000111100010801000e01010001010800000088800000111000001110000000000000000000000000
